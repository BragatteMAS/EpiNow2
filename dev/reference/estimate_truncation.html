<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Truncation of Observed Data — estimate_truncation • EpiNow2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Truncation of Observed Data — estimate_truncation"><meta name="description" content="
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
truncation argument in regional_epinow(), epinow(), and
estimate_infections() to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.
See here
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the epinowcast R package.
The model of truncation is as follows:
The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.
The data set with the latest observations is adjusted for truncation using
the truncation distribution.
Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.


This model is then fit using stan with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.
This approach assumes that:
Current truncation is related to past truncation.
Truncation is a multiplicative scaling of underlying reported cases.
Truncation is log normally distributed.

"><meta property="og:description" content="
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
truncation argument in regional_epinow(), epinow(), and
estimate_infections() to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.
See here
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the epinowcast R package.
The model of truncation is as follows:
The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.
The data set with the latest observations is adjusted for truncation using
the truncation distribution.
Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.


This model is then fit using stan with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.
This approach assumes that:
Current truncation is related to past truncation.
Truncation is a multiplicative scaling of underlying reported cases.
Truncation is log normally distributed.

"><meta property="og:image" content="https://epiforecasts.io/EpiNow2/reference/figures/unnamed-chunk-14-1.png"><meta property="og:image:alt" content="Example estimates produced by EpiNow2 of the reproduction number, cases by date of infection and cases by date of report"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@epiforecasts"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.7.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reference" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reference</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reference"><li><a class="dropdown-item" href="../reference/index.html">R Reference</a></li>
    <li><a class="dropdown-item" href="https://epiforecasts.io/EpiNow2/stan/">Stan Reference</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions"><li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage"><li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting_multiple_data_streams.html">Forecasting multiple data streams</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies"><li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate Truncation of Observed Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/main/R/estimate_truncation.R" class="external-link"><code>R/estimate_truncation.R</code></a></small>
      <div class="d-none name"><code>estimate_truncation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a>
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
<code>truncation</code> argument in <code><a href="regional_epinow.html">regional_epinow()</a></code>, <code><a href="epinow.html">epinow()</a></code>, and
<code><a href="estimate_infections.html">estimate_infections()</a></code> to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.</p>
<p>See <a href="https://gist.github.com/seabbs/176b0c7f83eab1a7192a25b28bbd116a" class="external-link">here</a>
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the <a href="https://package.epinowcast.org/" class="external-link"><code>epinowcast</code> R package</a>.</p>
<p>The model of truncation is as follows:</p><ol><li><p>The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.</p></li>
<li><p>The data set with the latest observations is adjusted for truncation using
the truncation distribution.</p></li>
<li><p>Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.</p></li>
</ol><p>This model is then fit using <code>stan</code> with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.</p>
<p>This approach assumes that:</p><ul><li><p>Current truncation is related to past truncation.</p></li>
<li><p>Truncation is a multiplicative scaling of underlying reported cases.</p></li>
<li><p>Truncation is log normally distributed.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_truncation</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="fu"><a href="Distributions.html">LogNormal</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, sdlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, max <span class="op">=</span></span>
<span>    <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stan <span class="op">=</span> <span class="fu"><a href="stan_opts.html">stan_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  CrIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  filter_leading_zeros <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  zero_threshold <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  weigh_delay_priors <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">obs</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A list of <code>&lt;data.frame&gt;</code>s each containing a date variable
and a confirm (numeric) variable. Each data set should be a snapshot
of the reported data over time. All data sets must contain a complete vector
of dates.</p></dd>


<dt id="arg-truncation">truncation<a class="anchor" aria-label="anchor" href="#arg-truncation"></a></dt>
<dd><p>A call to <code><a href="trunc_opts.html">trunc_opts()</a></code> defining the truncation of
the observed data. Defaults to <code><a href="trunc_opts.html">trunc_opts()</a></code>, i.e. no truncation.  See the
<code>estimate_truncation()</code> help file for an approach to estimating this from
data where the <code>dist</code> list element returned by <code>estimate_truncation()</code> is
used as the <code>truncation</code> argument here, thereby propagating the uncertainty
in the estimate.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A compiled stan model to override the default model. May be
useful for package developers or those developing extensions.</p></dd>


<dt id="arg-stan">stan<a class="anchor" aria-label="anchor" href="#arg-stan"></a></dt>
<dd><p>A list of stan options as generated by <code><a href="stan_opts.html">stan_opts()</a></code>. Defaults
to <code><a href="stan_opts.html">stan_opts()</a></code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p></dd>


<dt id="arg-cris">CrIs<a class="anchor" aria-label="anchor" href="#arg-cris"></a></dt>
<dd><p>Numeric vector of credible intervals to calculate.</p></dd>


<dt id="arg-filter-leading-zeros">filter_leading_zeros<a class="anchor" aria-label="anchor" href="#arg-filter-leading-zeros"></a></dt>
<dd><p>Logical, defaults to TRUE. Should zeros at the
start of the time series be filtered out.</p></dd>


<dt id="arg-zero-threshold">zero_threshold<a class="anchor" aria-label="anchor" href="#arg-zero-threshold"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a> Numeric defaults
to Inf. Indicates if detected zero cases are meaningful by using a threshold
number of cases based on the 7-day average. If the average is above this
threshold then the zero is replaced using <code>fill</code>.</p></dd>


<dt id="arg-weigh-delay-priors">weigh_delay_priors<a class="anchor" aria-label="anchor" href="#arg-weigh-delay-priors"></a></dt>
<dd><p>Deprecated; use the <code>weight_prior</code> option in
<code><a href="trunc_opts.html">trunc_opts()</a></code> instead.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, should model fitting progress be returned.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional parameters to pass to <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">rstan::sampling()</a></code>.</p></dd>


<dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>Deprecated; use <code>data</code> instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing: the summary parameters of the truncation
distribution (<code>dist</code>), which could be passed to the <code>truncation</code> argument
of <code><a href="epinow.html">epinow()</a></code>, <code><a href="regional_epinow.html">regional_epinow()</a></code>, and <code><a href="estimate_infections.html">estimate_infections()</a></code>, the
estimated CMF of the truncation distribution (<code>cmf</code>, can be used to
adjusted new data), a <code>&lt;data.frame&gt;</code> containing the observed truncated
data, latest observed data and the adjusted for
truncation observations (<code>obs</code>), a <code>&lt;data.frame&gt;</code> containing the last
observed data (<code>last_obs</code>, useful for plotting and validation), the data
used for fitting (<code>data</code>) and the fit object (<code>fit</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># set number of cores to use</span></span></span>
<span class="r-in"><span><span class="va">old_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit model to example data</span></span></span>
<span class="r-in"><span><span class="co"># See [example_truncated] for more details</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">estimate_truncation</span><span class="op">(</span><span class="va">example_truncated</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">2000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-07-27 19:28:06] estimate_truncation (chain: 1): There were 12 divergent transitions after warmup. See</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them. - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-07-27 19:28:06] estimate_truncation (chain: 1): Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># summary of the distribution</span></span></span>
<span class="r-in"><span><span class="va">est</span><span class="op">$</span><span class="va">dist</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - lognormal distribution (max: 10):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   meanlog:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - normal distribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         -1.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sd:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0.43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sdlog:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - normal distribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         2.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sd:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0.67</span>
<span class="r-in"><span><span class="co"># summary of the estimated truncation cmf (can be applied to new data)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">cmf</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     index      mean      se_mean           sd  lower_90  lower_50  lower_20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;int&gt;     &lt;num&gt;        &lt;num&gt;        &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:     1 1.0000000 2.801529e-18 1.256388e-16 1.0000000 1.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:     2 0.9971742 4.669561e-05 1.552579e-03 0.9945283 0.9961459 0.9968000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:     3 0.9937658 1.000945e-04 3.321900e-03 0.9881314 0.9915418 0.9929070</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:     4 0.9895641 1.619024e-04 5.362306e-03 0.9805792 0.9858907 0.9881376</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:     5 0.9842390 2.344679e-04 7.748545e-03 0.9713916 0.9788712 0.9820775</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:     6 0.9772399 3.210931e-04 1.058578e-02 0.9599252 0.9699245 0.9742254</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:     7 0.9675667 4.264622e-04 1.402416e-02 0.9451067 0.9576852 0.9633730</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:     8 0.9531682 5.567981e-04 1.827261e-02 0.9246759 0.9401235 0.9472359</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:     9 0.9289346 7.196446e-04 2.354254e-02 0.8933593 0.9125719 0.9212972</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:    10 0.8762642 7.678436e-04 2.907679e-02 0.8330842 0.8569209 0.8664747</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:    11 0.4195485 3.993806e-04 1.657050e-02 0.3952905 0.4084131 0.4143418</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        median  upper_20  upper_50  upper_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 1.0000000 1.0000000 1.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 0.9972564 0.9976576 0.9983536 0.9996674</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 0.9939005 0.9947529 0.9962641 0.9991707</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 0.9897026 0.9910789 0.9935417 0.9984056</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 0.9843023 0.9863243 0.9899002 0.9972676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 0.9771733 0.9799593 0.9848604 0.9954110</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 0.9670746 0.9708498 0.9773486 0.9921883</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 0.9521348 0.9571272 0.9653540 0.9859633</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: 0.9268308 0.9334569 0.9440645 0.9701574</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: 0.8733195 0.8809583 0.8936986 0.9251443</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: 0.4180231 0.4223019 0.4291331 0.4466159</span>
<span class="r-in"><span><span class="co"># observations linked to truncation adjusted estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           date confirm last_confirm report_date  mean se_mean    sd lower_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;Date&gt;   &lt;num&gt;        &lt;num&gt;      &lt;Date&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 2020-03-24    4764         4789  2020-04-01  5245       0    28     5199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 2020-03-25    5191         5249  2020-04-01  5184       1    40     5115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 2020-03-26    5102         5210  2020-04-01  6062       1    65     5951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 2020-03-27    5924         6153  2020-04-01  5754       2    83     5610</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 2020-03-28    5567         5959  2020-04-01  5550       3   106     5364</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 2020-03-29    5289         5974  2020-04-01  4505       3   113     4311</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 2020-03-30    4183         5217  2020-04-01  3048       2    99     2883</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 2020-03-31    2668         4050  2020-04-01  4012       3   155     3763</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: 2020-04-01    1681         4053  2020-04-01     0      NA     0        0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: 2020-03-29    5970         5974  2020-04-06  6007       0    20     5974</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: 2020-03-30    5209         5217  2020-04-06  5264       0    28     5217</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: 2020-03-31    4035         4050  2020-04-06  4099       0    32     4046</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: 2020-04-01    4020         4053  2020-04-06  4114       1    44     4038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: 2020-04-02    4697         4782  2020-04-06  4855       2    70     4733</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: 2020-04-03    4483         4668  2020-04-06  4704       2    89     4546</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: 2020-04-04    4182         4585  2020-04-06  4504       3   113     4310</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: 2020-04-05    3864         4805  2020-04-06  4414       3   144     4176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: 2020-04-06    2420         4316  2020-04-06  5776       5   223     5418</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19: 2020-04-03    4653         4668  2020-04-11  4682       0    15     4656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20: 2020-04-04    4554         4585  2020-04-11  4602       0    24     4561</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21: 2020-04-05    4741         4805  2020-04-11  4817       1    37     4753</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22: 2020-04-06    4208         4316  2020-04-11  4306       1    46     4227</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23: 2020-04-07    3431         3599  2020-04-11  3546       1    51     3458</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24: 2020-04-08    2779         3039  2020-04-11  2916       1    55     2818</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25: 2020-04-09    3234         3836  2020-04-11  3483       2    87     3333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26: 2020-04-10    2993         4204  2020-04-11  3419       2   111     3235</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27: 2020-04-11    1848         3951  2020-04-11  4411       4   170     4137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28: 2020-04-08    3036         3039  2020-04-16  3055       0    10     3038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29: 2020-04-09    3829         3836  2020-04-16  3869       0    20     3835</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30: 2020-04-10    4187         4204  2020-04-16  4254       1    33     4198</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31: 2020-04-11    3916         3951  2020-04-16  4007       1    43     3934</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32: 2020-04-12    4605         4686  2020-04-16  4760       2    68     4641</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33: 2020-04-13    3925         4074  2020-04-16  4119       2    78     3980</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34: 2020-04-14    2873         3124  2020-04-16  3094       2    77     2961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35: 2020-04-15    2393         2919  2020-04-16  2733       2    89     2586</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36: 2020-04-16    1512         2580  2020-04-16  3609       3   139     3385</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37: 2020-04-13    4074         4074  2020-04-21  4099       0    13     4077</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38: 2020-04-14    3124         3124  2020-04-21  3157       0    17     3128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39: 2020-04-15    2919         2919  2020-04-21  2965       0    23     2926</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40: 2020-04-16    2580         2580  2020-04-21  2640       0    28     2591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41: 2020-04-17    3563         3563  2020-04-21  3683       1    53     3591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42: 2020-04-18    3126         3126  2020-04-21  3280       1    62     3170</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43: 2020-04-19    2843         2843  2020-04-21  3062       2    76     2930</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44: 2020-04-20    2051         2051  2020-04-21  2343       1    76     2216</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45: 2020-04-21     962          962  2020-04-21  2296       2    88     2153</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           date confirm last_confirm report_date  mean se_mean    sd lower_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_50 lower_20 median upper_20 upper_50 upper_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        &lt;int&gt;    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:     5224     5237   5245     5253     5265     5293</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:     5154     5172   5183     5195     5212     5252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:     6015     6045   6062     6080     6107     6171</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:     5696     5734   5756     5778     5812     5890</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:     5478     5525   5554     5583     5625     5719</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:     4430     4481   4513     4540     4583     4682</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:     2985     3028   3055     3079     3113     3202</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:     3917     3980   4021     4057     4115     4252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:        0        0      0        0        0        0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:     5992     6001   6006     6012     6020     6041</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:     5242     5255   5263     5271     5283     5312</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:     4076     4090   4099     4108     4122     4153</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:     4081     4102   4113     4126     4144     4187</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:     4805     4838   4856     4875     4904     4969</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:     4643     4683   4708     4732     4768     4848</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:     4429     4480   4512     4539     4582     4681</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:     4323     4386   4424     4459     4509     4638</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:     5639     5730   5789     5840     5925     6122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:     4670     4677   4681     4686     4692     4708</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:     4583     4594   4601     4608     4619     4644</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21:     4789     4806   4816     4827     4843     4880</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22:     4272     4294   4306     4319     4338     4383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23:     3510     3534   3547     3561     3582     3630</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24:     2878     2903   2918     2933     2955     3005</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25:     3425     3464   3489     3510     3543     3620</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26:     3349     3397   3427     3454     3492     3592</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27:     4306     4376   4420     4460     4524     4675</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28:     3047     3052   3054     3057     3061     3072</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29:     3853     3863   3868     3874     3883     3904</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30:     4229     4245   4253     4263     4277     4310</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31:     3976     3996   4007     4019     4037     4079</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32:     4711     4743   4761     4780     4808     4872</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33:     4065     4100   4122     4143     4174     4244</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34:     3043     3077   3099     3118     3148     3215</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35:     2677     2716   2740     2761     2792     2872</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36:     3523     3580   3617     3649     3702     3825</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37:     4089     4095   4099     4103     4108     4122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38:     3144     3152   3156     3161     3168     3185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39:     2948     2959   2965     2972     2982     3004</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40:     2619     2632   2640     2648     2660     2687</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41:     3645     3669   3684     3698     3720     3769</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42:     3238     3266   3283     3300     3325     3380</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43:     3011     3045   3067     3085     3115     3182</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44:     2294     2328   2348     2367     2393     2461</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45:     2241     2277   2301     2321     2355     2433</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_50 lower_20 median upper_20 upper_50 upper_90</span>
<span class="r-in"><span><span class="co"># validation plot of observations vs estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.estimate_infections.html">plot</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_truncation-1.png" alt="" width="864" height="864"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pass the truncation distribution to `epinow()`.</span></span></span>
<span class="r-in"><span><span class="co"># Note, we're using the last snapshot as the observed data as it contains</span></span></span>
<span class="r-in"><span><span class="co"># all the previous snapshots. Also, we're using the default options for</span></span></span>
<span class="r-in"><span><span class="co"># illustrative purposes only.</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="epinow.html">epinow</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  generation_time <span class="op">=</span> <span class="fu"><a href="generation_time_opts.html">generation_time_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_truncated</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">dist</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Logging threshold set at INFO for the name logger</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Writing <span style="color: #0000BB;">EpiNow2</span> logs to the console and:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">/tmp/RtmpiO32lN/regional-epinow/2020-04-21.log</span>.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Logging threshold set at INFO for the name logger</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Writing <span style="color: #0000BB;">EpiNow2.epinow</span> logs to the console and:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">/tmp/RtmpiO32lN/epinow/2020-04-21.log</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-07-27 19:30:56] epinow: There were 12 divergent transitions after warmup. See</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them. - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-07-27 19:30:56] epinow: Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - </span>
<span class="r-in"><span><span class="fu"><a href="plot.estimate_infections.html">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_truncation-2.png" alt="" width="864" height="864"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">old_opts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, EpiForecasts, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

